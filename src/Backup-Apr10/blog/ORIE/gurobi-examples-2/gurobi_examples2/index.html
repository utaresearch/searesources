<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.109.0">
<title>Gurboi&#39;s R Examples 2 | Erick C. Jones Jr.</title>








  
    
  
<meta name="description" content="The personal and lab website for Erick C. Jones Jr..">


<meta property="og:site_name" content="Erick C. Jones Jr.">
<meta property="og:title" content="Gurboi&#39;s R Examples 2 | Erick C. Jones Jr.">
<meta property="og:description" content="The personal and lab website for Erick C. Jones Jr.." />
<meta property="og:type" content="page" />
<meta property="og:url" content="/blog/orie/gurobi-examples-2/gurobi_examples2/" />
<meta property="og:locale" content="en">




    
        <meta property="og:image" content="/blog/sidebar-listing.jpg" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="/blog/sidebar-listing.jpg" >
    
    
  <meta itemprop="name" content="Gurboi&#39;s R Examples 2">
<meta itemprop="description" content="This post explores how to use Gurobi to solve more advanced LPs, MIPs, and QPs. I have written these using Gurobi as a solver and as the mathematical formulation software. This is a reproducible example if you have R Studio just make sure you have installed the correct packages.
library(gurobi) ## Warning: package &#39;slam&#39; was built under R version 4.1.2 library(Matrix) This example formulates and solves the following simple QP model:"><meta itemprop="datePublished" content="2020-01-06T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-01-06T00:00:00+00:00" />
<meta itemprop="wordCount" content="5248">
<meta itemprop="keywords" content="R Markdown,QP,Gurboi,Algorithms," />
  
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="/img/favicon1.ico" type="image/x-icon">
  <link rel="icon" href="/img/favicon1.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/style.main.min.508aa34bb4fa7ebfddd6892a4ec251e1ce46ad0e0c5be6380abc84336f01b14e.css" integrity="sha256-UIqjS7T6fr/d1okqTsJR4c5GrQ4MW&#43;Y4CryEM28BsU4=" media="screen">
  
  
  <script src="/panelset.min.ed1ac24b6e16f4e2481e3d1d098ae66f5bc77438aef619e6e266d8ac5b00dc72.js" type="text/javascript"></script>
  
  
  <script src="/main.min.d6544777aaabf7d9bd89074f1eba9acd9e3aaaf0abdde635292a508d3c533ab9.js" type="text/javascript"></script>
</head>
<body>
      <div class="grid-container">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="/" title="Home">
      <img src="/img/SApic.jpg" class="dib db-l h2 w-auto" alt="Erick C. Jones Jr.">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/about/" title="About">About</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/project/" title="Project Portfolio">Projects</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/publication/" title="Publications">Publications</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/team/" title="Teams">TEAM</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/jointeam/" title="Join Team">Join Team</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="/blog/" title="Posts">Posts</a>
      
      
    </div>
  </nav>
</header>

<main class="page-main pa4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 ph4-l">
      <header class="post-header">
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">Gurboi&#39;s R Examples 2</h1>
        
        <p class="f6 measure lh-copy mv1">By Erick Jones in <a href="/categories/orie-techniques">ORIE Techniques</a> </p>
        <p class="f7 db mv0 ttu">January 6, 2020</p>

      

      </header>
      <section class="post-body pt5 pb4">
        <p>This post explores how to use Gurobi to solve more advanced LPs, MIPs, and QPs.
I have written these using Gurobi as a solver and as the mathematical formulation software.
This is a reproducible example if you have R Studio just  make sure you have installed the correct packages.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(gurobi)
</span></span></code></pre></div><pre tabindex="0"><code>## Warning: package &#39;slam&#39; was built under R version 4.1.2
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(Matrix)
</span></span></code></pre></div><p>This example formulates and solves the following simple QP model:</p>
<p><code>\(min:     x^2 + xy + y^2 + yz + z^2 + 2 x\)</code></p>
<p>subject to</p>
<pre><code>   `\(x + 2 y + 3z \geq 4\)`
   
   `\(x +   y      \geq 1\)`
   x, y, z non-negative
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>model <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">matrix</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3</span>,<span style="color:#099">1</span>,<span style="color:#099">1</span>,<span style="color:#099">0</span>), nrow<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>, byrow<span style="color:#000;font-weight:bold">=</span><span style="color:#999">T</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>Q     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">matrix</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>,<span style="color:#099">0.5</span>,<span style="color:#099">0</span>,<span style="color:#099">0.5</span>,<span style="color:#099">1</span>,<span style="color:#099">0.5</span>,<span style="color:#099">0</span>,<span style="color:#099">0.5</span>,<span style="color:#099">1</span>), nrow<span style="color:#000;font-weight:bold">=</span><span style="color:#099">3</span>, byrow<span style="color:#000;font-weight:bold">=</span><span style="color:#999">T</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>obj   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">2</span>,<span style="color:#099">0</span>,<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">4</span>,<span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;&gt;&#39;</span>, <span style="color:#d14">&#39;&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">gurobi</span>(model)
</span></span></code></pre></div><pre tabindex="0"><code>## Gurobi Optimizer version 9.1.2 build v9.1.2rc0 (win64)
## Thread count: 10 physical cores, 20 logical processors, using up to 20 threads
## Optimize a model with 2 rows, 3 columns and 5 nonzeros
## Model fingerprint: 0xe6f007c4
## Model has 5 quadratic objective terms
## Coefficient statistics:
##   Matrix range     [1e+00, 3e+00]
##   Objective range  [2e+00, 2e+00]
##   QObjective range [2e+00, 2e+00]
##   Bounds range     [0e+00, 0e+00]
##   RHS range        [1e+00, 4e+00]
## Presolve time: 0.00s
## Presolved: 2 rows, 3 columns, 5 nonzeros
## Presolved model has 5 quadratic objective terms
## Ordering time: 0.00s
## 
## Barrier statistics:
##  Free vars  : 2
##  AA&#39; NZ     : 6.000e+00
##  Factor NZ  : 1.000e+01
##  Factor Ops : 3.000e+01 (less than 1 second per iteration)
##  Threads    : 1
## 
##                   Objective                Residual
## Iter       Primal          Dual         Primal    Dual     Compl     Time
##    0   1.68862999e+05 -1.66862803e+05  1.50e+03 4.63e-07  9.99e+05     0s
##    1   3.32288030e+05 -3.31121401e+05  1.50e-03 4.55e-13  1.33e+05     0s
##    2   4.88215027e+04 -4.83744738e+04  1.50e-09 2.84e-14  1.94e+04     0s
##    3   7.20552197e+03 -7.03403484e+03  3.55e-14 1.42e-14  2.85e+03     0s
##    4   1.07582166e+03 -1.00982226e+03  1.78e-14 1.07e-14  4.17e+02     0s
##    5   1.65319400e+02 -1.39657698e+02  3.55e-15 3.55e-15  6.10e+01     0s
##    6   2.72141305e+01 -1.68504217e+01  1.33e-15 4.44e-16  8.81e+00     0s
##    7   5.34776479e+00 -4.13214640e-01  2.22e-16 2.22e-16  1.15e+00     0s
##    8   2.27046251e+00  2.04615758e+00  2.22e-16 4.44e-16  4.49e-02     0s
##    9   2.11217859e+00  2.11101837e+00  7.77e-15 1.67e-16  2.32e-04     0s
##   10   2.11111218e+00  2.11111102e+00  5.55e-16 3.29e-16  2.32e-07     0s
##   11   2.11111111e+00  2.11111111e+00  3.33e-15 3.33e-16  2.32e-10     0s
## 
## Barrier solved model in 11 iterations and 0.00 seconds
## Optimal objective 2.11111111e+00
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(result<span style="color:#000;font-weight:bold">$</span>objval)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 2.111111
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(result<span style="color:#000;font-weight:bold">$</span>x)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 3.584007e-10 1.000000e+00 6.666667e-01
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>vtype <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;I&#39;</span>, <span style="color:#d14">&#39;I&#39;</span>, <span style="color:#d14">&#39;I&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">gurobi</span>(model)
</span></span></code></pre></div><pre tabindex="0"><code>## Gurobi Optimizer version 9.1.2 build v9.1.2rc0 (win64)
## Thread count: 10 physical cores, 20 logical processors, using up to 20 threads
## Optimize a model with 2 rows, 3 columns and 5 nonzeros
## Model fingerprint: 0x2458258b
## Model has 5 quadratic objective terms
## Variable types: 0 continuous, 3 integer (0 binary)
## Coefficient statistics:
##   Matrix range     [1e+00, 3e+00]
##   Objective range  [2e+00, 2e+00]
##   QObjective range [2e+00, 2e+00]
##   Bounds range     [0e+00, 0e+00]
##   RHS range        [1e+00, 4e+00]
## Found heuristic solution: objective 2.000000e+19
## Presolve time: 0.00s
## Presolved: 2 rows, 3 columns, 5 nonzeros
## Presolved model has 5 quadratic objective terms
## Variable types: 0 continuous, 3 integer (0 binary)
## 
## Root relaxation: objective 2.111111e+00, 5 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0    2.11111    0    1 2.0000e+19    2.11111   100%     -    0s
## H    0     0                       3.0000000    2.11111  29.6%     -    0s
##      0     0    2.11111    0    1    3.00000    2.11111  29.6%     -    0s
## 
## Explored 1 nodes (5 simplex iterations) in 0.00 seconds
## Thread count was 20 (of 20 available processors)
## 
## Solution count 2: 3 2e+19 
## 
## Optimal solution found (tolerance 1.00e-04)
## Best objective 3.000000000000e+00, best bound 3.000000000000e+00, gap 0.0000%
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(result<span style="color:#000;font-weight:bold">$</span>objval)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 3
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(result<span style="color:#000;font-weight:bold">$</span>x)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 0 1 1
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Clear space</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">rm</span>(model, result)
</span></span></code></pre></div><p>This example formulates and solves the following simple QCP model:
<code>\(max: x\)</code></p>
<p>subject to</p>
<p><code>\(x + y + z   =  1\)</code></p>
<p><code>\(x^2 + y^2 \leq z^2\)</code>  (second-order cone)
$ x^2 \leq yz$         (rotated second-order cone)
x, y, z non-negative</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>model <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A          <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">matrix</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>,<span style="color:#099">1</span>,<span style="color:#099">1</span>), nrow<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>, byrow<span style="color:#000;font-weight:bold">=</span><span style="color:#999">T</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>modelsense <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;max&#39;</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>obj        <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>,<span style="color:#099">0</span>,<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs        <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense      <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;=&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># First quadratic constraint: x^2 + y^2 - z^2 &lt;= 0</span>
</span></span><span style="display:flex;"><span>qc1 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>qc1<span style="color:#000;font-weight:bold">$</span>Qc <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(<span style="color:#099">3</span>, <span style="color:#099">3</span>, <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>), <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>), <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1.0</span>, <span style="color:#099">1.0</span>, <span style="color:#099">-1.0</span>))
</span></span><span style="display:flex;"><span>qc1<span style="color:#000;font-weight:bold">$</span>rhs <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Second quadratic constraint: x^2 - yz &lt;= 0</span>
</span></span><span style="display:flex;"><span>qc2 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>qc2<span style="color:#000;font-weight:bold">$</span>Qc <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(<span style="color:#099">3</span>, <span style="color:#099">3</span>, <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>, <span style="color:#099">2</span>), <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>, <span style="color:#099">3</span>), <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1.0</span>, <span style="color:#099">-1.0</span>))
</span></span><span style="display:flex;"><span>qc2<span style="color:#000;font-weight:bold">$</span>rhs <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>quadcon <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>(qc1, qc2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">gurobi</span>(model)
</span></span></code></pre></div><pre tabindex="0"><code>## Gurobi Optimizer version 9.1.2 build v9.1.2rc0 (win64)
## Thread count: 10 physical cores, 20 logical processors, using up to 20 threads
## Optimize a model with 1 rows, 3 columns and 3 nonzeros
## Model fingerprint: 0xc90fd276
## Model has 2 quadratic constraints
## Coefficient statistics:
##   Matrix range     [1e+00, 1e+00]
##   QMatrix range    [1e+00, 1e+00]
##   Objective range  [1e+00, 1e+00]
##   Bounds range     [0e+00, 0e+00]
##   RHS range        [1e+00, 1e+00]
## Presolve time: 0.00s
## Presolved: 6 rows, 6 columns, 13 nonzeros
## Presolved model has 2 second-order cone constraints
## Ordering time: 0.00s
## 
## Barrier statistics:
##  AA&#39; NZ     : 1.500e+01
##  Factor NZ  : 2.100e+01
##  Factor Ops : 9.100e+01 (less than 1 second per iteration)
##  Threads    : 1
## 
##                   Objective                Residual
## Iter       Primal          Dual         Primal    Dual     Compl     Time
##    0   2.38095238e-01  2.38095238e-01  1.11e-16 4.33e-01  9.23e-02     0s
##    1   3.20481543e-01  3.62123302e-01  5.55e-17 1.39e-02  7.95e-03     0s
##    2   3.26649101e-01  3.28651430e-01  1.15e-14 5.44e-04  3.46e-04     0s
##    3   3.26797051e-01  3.27019441e-01  1.37e-13 5.98e-10  2.78e-05     0s
##    4   3.26990986e-01  3.26994814e-01  6.54e-13 3.46e-13  4.78e-07     0s
##    5   3.26992304e-01  3.26992876e-01  3.23e-11 1.94e-14  7.15e-08     0s
## 
## Barrier solved model in 5 iterations and 0.00 seconds
## Optimal objective 3.26992304e-01
## 
## Warning: to get QCP duals, please set parameter QCPDual to 1
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(result<span style="color:#000;font-weight:bold">$</span>objval)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 0.3269923
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(result<span style="color:#000;font-weight:bold">$</span>x)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 0.3269923 0.2570664 0.4159413
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Clear space</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">rm</span>(model, result)
</span></span></code></pre></div><p>This example considers the following separable, convex problem:</p>
<p><code>\(min:  f(x) - y + g(z)\)</code></p>
<p>subject to</p>
<p><code>\(x + 2 y + 3 z   \leq 4\)</code>
<code>\(x +   y         \geq 1\)</code>
<code>\(x,    y,    z \geq 0\)</code></p>
<p>where <code>\(f(u) = e^{-u} \text{ and} \: g(u) = 2 u^2 - 4u\: \forall \text{ real}\: u\)</code></p>
<p>It formulates and solves a simpler LP model by approximating f and
g with piecewise-linear functions.  Then it transforms the model
into a MIP by negating the approximation for f, which gives
a non-convex piecewise-linear function, and solves it again.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(gurobi)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">matrix</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3</span>,<span style="color:#099">1</span>,<span style="color:#099">1</span>,<span style="color:#099">0</span>), nrow<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>, byrow<span style="color:#000;font-weight:bold">=</span><span style="color:#999">T</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>obj   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0</span>,<span style="color:#099">-1</span>,<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>ub    <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span>,<span style="color:#099">1</span>,<span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">4</span>,<span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;&lt;&#39;</span>, <span style="color:#d14">&#39;&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Uniformly spaced points in [0.0, 1.0]</span>
</span></span><span style="display:flex;"><span>u <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">seq</span>(from<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>, to<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>, by<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.01</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># First piecewise-linear function: f(x) = exp(-x)</span>
</span></span><span style="display:flex;"><span>pwl1     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>pwl1<span style="color:#000;font-weight:bold">$</span>var <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>pwl1<span style="color:#000;font-weight:bold">$</span>x   <span style="color:#000;font-weight:bold">&lt;-</span> u
</span></span><span style="display:flex;"><span>pwl1<span style="color:#000;font-weight:bold">$</span>y   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">sapply</span>(u, <span style="color:#900;font-weight:bold">function</span>(x) <span style="color:#900;font-weight:bold">exp</span>(<span style="color:#000;font-weight:bold">-</span>x))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Second piecewise-linear function: g(z) = 2 z^2 - 4 z</span>
</span></span><span style="display:flex;"><span>pwl2     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>pwl2<span style="color:#000;font-weight:bold">$</span>var <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>pwl2<span style="color:#000;font-weight:bold">$</span>x   <span style="color:#000;font-weight:bold">&lt;-</span> u
</span></span><span style="display:flex;"><span>pwl2<span style="color:#000;font-weight:bold">$</span>y   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">sapply</span>(u, <span style="color:#900;font-weight:bold">function</span>(z) <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">*</span> z <span style="color:#000;font-weight:bold">*</span> z <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">4</span> <span style="color:#000;font-weight:bold">*</span> z)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>pwlobj <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>(pwl1, pwl2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">gurobi</span>(model)
</span></span></code></pre></div><pre tabindex="0"><code>## Gurobi Optimizer version 9.1.2 build v9.1.2rc0 (win64)
## Thread count: 10 physical cores, 20 logical processors, using up to 20 threads
## Optimize a model with 2 rows, 3 columns and 5 nonzeros
## Model fingerprint: 0xc12b5aad
## Model has 2 piecewise-linear objective terms
## Coefficient statistics:
##   Matrix range     [1e+00, 3e+00]
##   Objective range  [1e+00, 1e+00]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [1e+00, 4e+00]
## Presolve time: 0.00s
## Presolved: 2 rows, 3 columns, 5 nonzeros
## 
## Iteration    Objective       Primal Inf.    Dual Inf.      Time
##        0   -2.6321206e+00   5.000000e-01   0.000000e+00      0s
##        2   -1.9346239e+00   0.000000e+00   0.000000e+00      0s
## 
## Solved in 2 iterations and 0.00 seconds
## Optimal objective -1.934623931e+00
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(result<span style="color:#000;font-weight:bold">$</span>objval)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] -1.934624
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(result<span style="color:#000;font-weight:bold">$</span>x)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 0.690 0.725 0.620
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Negate piecewise-linear function on x, making it non-convex</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>pwlobj[[1]]<span style="color:#000;font-weight:bold">$</span>y <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">sapply</span>(u, <span style="color:#900;font-weight:bold">function</span>(x) <span style="color:#000;font-weight:bold">-</span><span style="color:#900;font-weight:bold">exp</span>(<span style="color:#000;font-weight:bold">-</span>x))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">gurobi</span>(model)
</span></span></code></pre></div><pre tabindex="0"><code>## Gurobi Optimizer version 9.1.2 build v9.1.2rc0 (win64)
## Thread count: 10 physical cores, 20 logical processors, using up to 20 threads
## Optimize a model with 2 rows, 3 columns and 5 nonzeros
## Model fingerprint: 0x3229e670
## Model has 2 piecewise-linear objective terms
## Variable types: 3 continuous, 0 integer (0 binary)
## Coefficient statistics:
##   Matrix range     [1e+00, 3e+00]
##   Objective range  [1e+00, 1e+00]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [1e+00, 4e+00]
## Found heuristic solution: objective -1.3678794
## Presolve time: 0.00s
## Presolved: 202 rows, 302 columns, 603 nonzeros
## Variable types: 203 continuous, 99 integer (99 binary)
## 
## Root relaxation: objective -3.777733e+00, 1 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
## *    0     0               0      -3.7777333   -3.77773  0.00%     -    0s
## 
## Explored 0 nodes (1 simplex iterations) in 0.00 seconds
## Thread count was 20 (of 20 available processors)
## 
## Solution count 2: -3.77773 -1.36788 
## No other solutions better than -3.77773
## 
## Optimal solution found (tolerance 1.00e-04)
## Best objective -3.777733333333e+00, best bound -3.777733333333e+00, gap 0.0000%
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">gurobi_write</span>(model, <span style="color:#d14">&#34;pwl.lp&#34;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## NULL
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(result<span style="color:#000;font-weight:bold">$</span>objval)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] -3.777733
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">print</span>(result<span style="color:#000;font-weight:bold">$</span>x)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 0.0000000 1.0000000 0.6666667
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Clear space</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">rm</span>(model, pwl1, pwl2, result)
</span></span></code></pre></div><p>Want to cover three different sets but subject to a common budget of
elements allowed to be used. However, the sets have different priorities to
be covered; and we tackle this by using multi-objective optimization.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># define primitive data</span>
</span></span><span style="display:flex;"><span>groundSetSize     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">20</span>
</span></span><span style="display:flex;"><span>nSubSets          <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>Budget            <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">12</span>
</span></span><span style="display:flex;"><span>Set               <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span> ),
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span> ),
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span> ) )
</span></span><span style="display:flex;"><span>SetObjPriority    <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">3</span>, <span style="color:#099">2</span>, <span style="color:#099">2</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>SetObjWeight      <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1.0</span>, <span style="color:#099">0.25</span>, <span style="color:#099">1.25</span>, <span style="color:#099">1.0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Initialize model</span>
</span></span><span style="display:flex;"><span>model             <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>modelsense  <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;max&#39;</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>modelname   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;multiobj&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set variables, all of them are binary, with 0,1 bounds.</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>vtype       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;B&#39;</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>lb          <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>ub          <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>varnames    <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">paste</span>(<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#d14">&#39;El&#39;</span>, groundSetSize), <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>groundSetSize, sep<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Build constraint matrix</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A           <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(<span style="color:#099">1</span>, groundSetSize,
</span></span><span style="display:flex;"><span>                              i <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,groundSetSize),
</span></span><span style="display:flex;"><span>                              j <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>groundSetSize,
</span></span><span style="display:flex;"><span>                              x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,groundSetSize))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs         <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(Budget)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;&lt;&#39;</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>constrnames <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;Budget&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set multi-objectives</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj          <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">for </span>(m in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nSubSets) {
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>multiobj[[m]]          <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>multiobj[[m]]<span style="color:#000;font-weight:bold">$</span>objn     <span style="color:#000;font-weight:bold">&lt;-</span> Set[[m]]
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>multiobj[[m]]<span style="color:#000;font-weight:bold">$</span>priority <span style="color:#000;font-weight:bold">&lt;-</span> SetObjPriority[m]
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>multiobj[[m]]<span style="color:#000;font-weight:bold">$</span>weight   <span style="color:#000;font-weight:bold">&lt;-</span> SetObjWeight[m]
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>multiobj[[m]]<span style="color:#000;font-weight:bold">$</span>abstol   <span style="color:#000;font-weight:bold">&lt;-</span> m
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>multiobj[[m]]<span style="color:#000;font-weight:bold">$</span>reltol   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0.01</span>
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>multiobj[[m]]<span style="color:#000;font-weight:bold">$</span>name     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">sprintf</span>(<span style="color:#d14">&#39;Set%d&#39;</span>, m)
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>multiobj[[m]]<span style="color:#000;font-weight:bold">$</span>con      <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Save model</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">gurobi_write</span>(model,<span style="color:#d14">&#39;multiobj_R.lp&#39;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## NULL
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set parameters</span>
</span></span><span style="display:flex;"><span>params               <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>params<span style="color:#000;font-weight:bold">$</span>PoolSolutions <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Optimize</span>
</span></span><span style="display:flex;"><span>result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">gurobi</span>(model, params)
</span></span></code></pre></div><pre tabindex="0"><code>## Gurobi Optimizer version 9.1.2 build v9.1.2rc0 (win64)
## Thread count: 10 physical cores, 20 logical processors, using up to 20 threads
## Optimize a model with 1 rows, 20 columns and 20 nonzeros
## Model fingerprint: 0x82f8d485
## Variable types: 0 continuous, 20 integer (20 binary)
## Coefficient statistics:
##   Matrix range     [1e+00, 1e+00]
##   Objective range  [1e+00, 1e+00]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [1e+01, 1e+01]
## 
## ---------------------------------------------------------------------------
## Multi-objectives: starting optimization with 4 objectives (3 combined) ...
## ---------------------------------------------------------------------------
## 
## Multi-objectives: applying initial presolve ...
## ---------------------------------------------------------------------------
## 
## Presolve time: 0.00s
## Presolved: 1 rows and 20 columns
## ---------------------------------------------------------------------------
## 
## Multi-objectives: optimize objective 1 (Set1) ...
## ---------------------------------------------------------------------------
## 
## Found heuristic solution: objective 10.0000000
## 
## Explored 0 nodes (0 simplex iterations) in 0.00 seconds
## Thread count was 1 (of 20 available processors)
## 
## Solution count 1: 10 
## 
## Optimal solution found (tolerance 1.00e-04)
## Best objective 1.000000000000e+01, best bound 1.000000000000e+01, gap 0.0000%
## ---------------------------------------------------------------------------
## 
## Multi-objectives: optimize objective 2 (weighted) ...
## ---------------------------------------------------------------------------
## 
## 
## Loaded user MIP start with objective 6.25
## 
## Presolve removed 2 rows and 20 columns
## Presolve time: 0.00s
## Presolve: All rows and columns removed
## 
## Explored 0 nodes (0 simplex iterations) in 0.00 seconds
## Thread count was 1 (of 20 available processors)
## 
## Solution count 2: 10.5 6.25 
## 
## Optimal solution found (tolerance 1.00e-04)
## Best objective 1.050000000000e+01, best bound 1.050000000000e+01, gap 0.0000%
## ---------------------------------------------------------------------------
## 
## Multi-objectives: optimize objective 3 (Set4) ...
## ---------------------------------------------------------------------------
## 
## 
## Loaded user MIP start with objective 6
## 
## Presolve removed 3 rows and 20 columns
## Presolve time: 0.00s
## Presolve: All rows and columns removed
## 
## Explored 0 nodes (0 simplex iterations) in 0.00 seconds
## Thread count was 1 (of 20 available processors)
## 
## Solution count 2: 7 6 
## 
## Optimal solution found (tolerance 1.00e-04)
## Best objective 7.000000000000e+00, best bound 7.000000000000e+00, gap 0.0000%
## 
## ---------------------------------------------------------------------------
## Multi-objectives: solved in 0.00 seconds, solution count 3
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Capture solution information</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">if </span>(result<span style="color:#000;font-weight:bold">$</span>status <span style="color:#000;font-weight:bold">!=</span> <span style="color:#d14">&#39;OPTIMAL&#39;</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Optimization finished with status&#39;</span>, result<span style="color:#000;font-weight:bold">$</span>status, <span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">stop</span>(<span style="color:#d14">&#39;Stop now\n&#39;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Print best solution</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Selected elements in best solution:\n&#39;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## Selected elements in best solution:
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">for </span>(e in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>groundSetSize) {
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">if</span>(result<span style="color:#000;font-weight:bold">$</span>x[e] <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">0.9</span>) next
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39; El&#39;</span>,e,sep<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><pre tabindex="0"><code>##  El2 El3 El4 El5 El6 El7 El8 El9 El10 El11 El12 El17
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;\n&#39;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Iterate over the best 10 solutions</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">if </span>(<span style="color:#d14">&#39;pool&#39;</span> <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">names</span>(result)) {
</span></span><span style="display:flex;"><span>  solcount <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">length</span>(result<span style="color:#000;font-weight:bold">$</span>pool)
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Number of solutions found:&#39;</span>, solcount, <span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">if </span>(solcount <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">10</span>) {
</span></span><span style="display:flex;"><span>    solcount <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">10</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Objective values for first&#39;</span>, solcount, <span style="color:#d14">&#39;solutions:\n&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">for </span>(k in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>solcount) {
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Solution&#39;</span>, k, <span style="color:#d14">&#39;has objective:&#39;</span>, result<span style="color:#000;font-weight:bold">$</span>pool[[k]]<span style="color:#000;font-weight:bold">$</span>objval[1], <span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>} else {
</span></span><span style="display:flex;"><span>  solcount <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Number of solutions found:&#39;</span>, solcount, <span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Solution 1 has objective:&#39;</span>, result<span style="color:#000;font-weight:bold">$</span>objval, <span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><pre tabindex="0"><code>## Number of solutions found: 3 
## Objective values for first 3 solutions:
## Solution 1 has objective: 9 
## Solution 2 has objective: 9 
## Solution 3 has objective: 10
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Clean up</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">rm</span>(model, params, result)
</span></span></code></pre></div><p>Assign workers to shifts; each worker may or may not be available on a
particular day.  We use Pareto optimization to solve the model:
first, we minimize the linear sum of the slacks. Then, we constrain
the sum of the slacks, and we minimize a quadratic objective that
tries to balance the workload among the workers.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># define data</span>
</span></span><span style="display:flex;"><span>nShifts       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">14</span>
</span></span><span style="display:flex;"><span>nWorkers      <span style="color:#000;font-weight:bold">&lt;-</span>  <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>nVars         <span style="color:#000;font-weight:bold">&lt;-</span> (nShifts <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">*</span> (nWorkers <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">+</span> nWorkers <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>varIdx        <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(w,s) {s<span style="color:#000;font-weight:bold">+</span>(w<span style="color:#099">-1</span>)<span style="color:#000;font-weight:bold">*</span>nShifts}
</span></span><span style="display:flex;"><span>shiftSlackIdx <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(s) {s<span style="color:#000;font-weight:bold">+</span>nShifts<span style="color:#000;font-weight:bold">*</span>nWorkers}
</span></span><span style="display:flex;"><span>totShiftIdx   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(w) {w <span style="color:#000;font-weight:bold">+</span> nShifts <span style="color:#000;font-weight:bold">*</span> (nWorkers<span style="color:#099">+1</span>)}
</span></span><span style="display:flex;"><span>avgShiftIdx   <span style="color:#000;font-weight:bold">&lt;-</span> ((nShifts<span style="color:#099">+1</span>)<span style="color:#000;font-weight:bold">*</span>(nWorkers<span style="color:#099">+1</span>))
</span></span><span style="display:flex;"><span>diffShiftIdx  <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(w) {w <span style="color:#000;font-weight:bold">+</span> avgShiftIdx}
</span></span><span style="display:flex;"><span>totalSlackIdx <span style="color:#000;font-weight:bold">&lt;-</span> nVars
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Shifts  <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;Mon1&#39;</span>, <span style="color:#d14">&#39;Tue2&#39;</span>, <span style="color:#d14">&#39;Wed3&#39;</span>, <span style="color:#d14">&#39;Thu4&#39;</span>, <span style="color:#d14">&#39;Fri5&#39;</span>, <span style="color:#d14">&#39;Sat6&#39;</span>, <span style="color:#d14">&#39;Sun7&#39;</span>,
</span></span><span style="display:flex;"><span>             <span style="color:#d14">&#39;Mon8&#39;</span>, <span style="color:#d14">&#39;Tue9&#39;</span>, <span style="color:#d14">&#39;Wed10&#39;</span>, <span style="color:#d14">&#39;Thu11&#39;</span>, <span style="color:#d14">&#39;Fri12&#39;</span>, <span style="color:#d14">&#39;Sat13&#39;</span>, <span style="color:#d14">&#39;Sun14&#39;</span>)
</span></span><span style="display:flex;"><span>Workers <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>( <span style="color:#d14">&#39;Amy&#39;</span>, <span style="color:#d14">&#39;Bob&#39;</span>, <span style="color:#d14">&#39;Cathy&#39;</span>, <span style="color:#d14">&#39;Dan&#39;</span>, <span style="color:#d14">&#39;Ed&#39;</span>, <span style="color:#d14">&#39;Fred&#39;</span>, <span style="color:#d14">&#39;Gu&#39;</span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>shiftRequirements <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">3</span>, <span style="color:#099">2</span>, <span style="color:#099">4</span>, <span style="color:#099">4</span>, <span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">5</span>, <span style="color:#099">2</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>, <span style="color:#099">6</span>, <span style="color:#099">7</span>, <span style="color:#099">5</span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>availability <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>( <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ) )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Function to display results</span>
</span></span><span style="display:flex;"><span>solveandprint <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(model, env) {
</span></span><span style="display:flex;"><span>  result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">gurobi</span>(model, env <span style="color:#000;font-weight:bold">=</span> env)
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">if</span>(result<span style="color:#000;font-weight:bold">$</span>status <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;OPTIMAL&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;The optimal objective is&#39;</span>,result<span style="color:#000;font-weight:bold">$</span>objval,<span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Schedule:\n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">for </span>(s in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts) {
</span></span><span style="display:flex;"><span>      <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;\t&#39;</span>,Shifts[s],<span style="color:#d14">&#39;:&#39;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#900;font-weight:bold">for </span>(w in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers) {
</span></span><span style="display:flex;"><span>        <span style="color:#900;font-weight:bold">if </span>(result<span style="color:#000;font-weight:bold">$</span>x<span style="color:#900;font-weight:bold">[varIdx</span>(w,s)] <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0.9</span>) <span style="color:#900;font-weight:bold">cat</span>(Workers[w],<span style="color:#d14">&#39; &#39;</span>)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Workload:\n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">for </span>(w in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers) {
</span></span><span style="display:flex;"><span>      <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;\t&#39;</span>,Workers[w],<span style="color:#d14">&#39;:&#39;</span>,result<span style="color:#000;font-weight:bold">$</span>x<span style="color:#900;font-weight:bold">[totShiftIdx</span>(w)],<span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  } else {
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Optimization finished with status&#39;</span>,result<span style="color:#000;font-weight:bold">$</span>status)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  result
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set-up environment</span>
</span></span><span style="display:flex;"><span>env <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>env<span style="color:#000;font-weight:bold">$</span>logfile <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;workforce4.log&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Build model</span>
</span></span><span style="display:flex;"><span>model            <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>modelname  <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;workforce4&#39;</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>modelsense <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;min&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Initialize assignment decision variables:</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#    x[w][s] == 1 if worker w is assigned to shift s.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#    This is no longer a pure assignment model, so we must</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#    use binary variables.</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>vtype    <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#d14">&#39;C&#39;</span>, nVars)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>lb       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">0</span>, nVars)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>ub       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>, nVars)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>obj      <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">0</span>, nVars)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>varnames <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#d14">&#39;&#39;</span>,nVars)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">for </span>(w in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers) {
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">for </span>(s in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts) {
</span></span><span style="display:flex;"><span>    model<span style="color:#000;font-weight:bold">$</span>vtype<span style="color:#900;font-weight:bold">[varIdx</span>(w,s)]    <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;B&#39;</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#000;font-weight:bold">$</span>varnames<span style="color:#900;font-weight:bold">[varIdx</span>(w,s)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(Workers[w],<span style="color:#d14">&#39;.&#39;</span>,Shifts[s])
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">if </span>(availability[[w]][s] <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span>) model<span style="color:#000;font-weight:bold">$</span>ub<span style="color:#900;font-weight:bold">[varIdx</span>(w,s)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Initialize shift slack variables</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">for </span>(s in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts) {
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>varnames<span style="color:#900;font-weight:bold">[shiftSlackIdx</span>(s)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#39;ShiftSlack&#39;</span>,Shifts[s])
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>ub<span style="color:#900;font-weight:bold">[shiftSlackIdx</span>(s)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Initialize worker slack and diff variables</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">for </span>(w in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers) {
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>varnames<span style="color:#900;font-weight:bold">[totShiftIdx</span>(w)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#39;TotalShifts&#39;</span>,Workers[w])
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>ub<span style="color:#900;font-weight:bold">[totShiftIdx</span>(w)]       <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>varnames<span style="color:#900;font-weight:bold">[diffShiftIdx</span>(w)]  <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#39;DiffShifts&#39;</span>,Workers[w])
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>ub<span style="color:#900;font-weight:bold">[diffShiftIdx</span>(w)]        <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>lb<span style="color:#900;font-weight:bold">[diffShiftIdx</span>(w)]        <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Initialize average shift variable</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>ub[avgShiftIdx]      <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>varnames[avgShiftIdx] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;AvgShift&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Initialize total slack variable</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>ub[totalSlackIdx]      <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>varnames[totalSlackIdx] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;TotalSlack&#39;</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>obj[totalSlackIdx]     <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set-up shift-requirements constraints</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A           <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(nShifts,nVars,
</span></span><span style="display:flex;"><span>                      i <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">mapply</span>(rep,<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts,nWorkers)),
</span></span><span style="display:flex;"><span>                            <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts)),
</span></span><span style="display:flex;"><span>                      j <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">mapply</span>(varIdx,<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers,
</span></span><span style="display:flex;"><span>                                 <span style="color:#900;font-weight:bold">mapply</span>(rep,<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts,nWorkers)),
</span></span><span style="display:flex;"><span>                            <span style="color:#900;font-weight:bold">shiftSlackIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts)),
</span></span><span style="display:flex;"><span>                      x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,nShifts <span style="color:#000;font-weight:bold">*</span> (nWorkers<span style="color:#099">+1</span>)))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#d14">&#39;=&#39;</span>,nShifts)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs         <span style="color:#000;font-weight:bold">&lt;-</span> shiftRequirements
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>constrnames <span style="color:#000;font-weight:bold">&lt;-</span> Shifts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set TotalSlack equal to the sum of each shift slack</span>
</span></span><span style="display:flex;"><span>B <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(<span style="color:#099">1</span>, nVars,
</span></span><span style="display:flex;"><span>        i <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,nShifts<span style="color:#099">+1</span>),
</span></span><span style="display:flex;"><span>        j <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">shiftSlackIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts),totalSlackIdx),
</span></span><span style="display:flex;"><span>        x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,nShifts),<span style="color:#099">-1</span>))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A           <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rbind</span>(model<span style="color:#000;font-weight:bold">$</span>A, B)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs         <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>rhs,<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>sense,<span style="color:#d14">&#39;=&#39;</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>constrnames <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>constrnames, <span style="color:#d14">&#39;TotalSlack&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set total number of shifts for each worker</span>
</span></span><span style="display:flex;"><span>B <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(nWorkers, nVars,
</span></span><span style="display:flex;"><span>          i <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">mapply</span>(rep,<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers,nShifts),
</span></span><span style="display:flex;"><span>                <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers),
</span></span><span style="display:flex;"><span>          j <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">mapply</span>(varIdx,<span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">mapply</span>(rep,<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers,nShifts)),<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts),
</span></span><span style="display:flex;"><span>                <span style="color:#900;font-weight:bold">totShiftIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers)),
</span></span><span style="display:flex;"><span>          x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,nShifts<span style="color:#000;font-weight:bold">*</span>nWorkers),<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">-1</span>,nWorkers)))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A           <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rbind</span>(model<span style="color:#000;font-weight:bold">$</span>A, B)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs         <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>rhs,<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">0</span>,nWorkers))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>sense,<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#d14">&#39;=&#39;</span>,nWorkers))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>constrnames <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>constrnames, <span style="color:#900;font-weight:bold">sprintf</span>(<span style="color:#d14">&#39;TotalShifts%s&#39;</span>,Workers[1<span style="color:#000;font-weight:bold">:</span>nWorkers]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Save initial model</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">gurobi_write</span>(model,<span style="color:#d14">&#39;workforce4.lp&#39;</span>, env)
</span></span></code></pre></div><pre tabindex="0"><code>## NULL
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Optimize</span>
</span></span><span style="display:flex;"><span>result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">solveandprint</span>(model, env)
</span></span></code></pre></div><pre tabindex="0"><code>## Gurobi Optimizer version 9.1.2 build v9.1.2rc0 (win64)
## Thread count: 10 physical cores, 20 logical processors, using up to 20 threads
## Optimize a model with 22 rows, 128 columns and 232 nonzeros
## Model fingerprint: 0x829a1cb8
## Variable types: 30 continuous, 98 integer (98 binary)
## Coefficient statistics:
##   Matrix range     [1e+00, 1e+00]
##   Objective range  [1e+00, 1e+00]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [2e+00, 7e+00]
## Found heuristic solution: objective 58.0000000
## Presolve removed 22 rows and 128 columns
## Presolve time: 0.00s
## Presolve: All rows and columns removed
## 
## Explored 0 nodes (0 simplex iterations) in 0.00 seconds
## Thread count was 1 (of 20 available processors)
## 
## Solution count 2: 6 58 
## 
## Optimal solution found (tolerance 1.00e-04)
## Best objective 6.000000000000e+00, best bound 6.000000000000e+00, gap 0.0000%
## The optimal objective is 6 
## Schedule:
## 	 Mon1 :Bob  Fred  Gu  
## 	 Tue2 :Amy  Ed  
## 	 Wed3 :Amy  Cathy  Fred  Gu  
## 	 Thu4 :Cathy  Ed  
## 	 Fri5 :Amy  Bob  Cathy  Ed  Gu  
## 	 Sat6 :Bob  Dan  Fred  Gu  
## 	 Sun7 :Amy  Cathy  Ed  Gu  
## 	 Mon8 :Fred  Gu  
## 	 Tue9 :Amy  Ed  
## 	 Wed10 :Amy  Cathy  Gu  
## 	 Thu11 :Amy  Dan  Ed  Gu  
## 	 Fri12 :Amy  Cathy  Dan  Fred  Gu  
## 	 Sat13 :Amy  Bob  Cathy  Dan  Ed  Fred  Gu  
## 	 Sun14 :Amy  Cathy  Dan  Fred  Gu  
## Workload:
## 	 Amy : 10 
## 	 Bob : 4 
## 	 Cathy : 8 
## 	 Dan : 5 
## 	 Ed : 7 
## 	 Fred : 7 
## 	 Gu : 11
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">if </span>(result<span style="color:#000;font-weight:bold">$</span>status <span style="color:#000;font-weight:bold">!=</span> <span style="color:#d14">&#39;OPTIMAL&#39;</span>) <span style="color:#900;font-weight:bold">stop</span>(<span style="color:#d14">&#39;Stop now\n&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Constraint the slack by setting its upper and lower bounds</span>
</span></span><span style="display:flex;"><span>totalSlack <span style="color:#000;font-weight:bold">&lt;-</span> result<span style="color:#000;font-weight:bold">$</span>x[totalSlackIdx]
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>lb[totalSlackIdx] <span style="color:#000;font-weight:bold">=</span> totalSlack
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>ub[totalSlackIdx] <span style="color:#000;font-weight:bold">=</span> totalSlack
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Link average number of shifts worked and difference with average</span>
</span></span><span style="display:flex;"><span>B <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(nWorkers<span style="color:#099">+1</span>, nVars,
</span></span><span style="display:flex;"><span>        i <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers,
</span></span><span style="display:flex;"><span>              <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers,
</span></span><span style="display:flex;"><span>              <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers,
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">rep</span>(nWorkers<span style="color:#099">+1</span>,nWorkers<span style="color:#099">+1</span>)),
</span></span><span style="display:flex;"><span>        j <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">totShiftIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers),
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">diffShiftIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers),
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">rep</span>(avgShiftIdx,nWorkers),
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">totShiftIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers),avgShiftIdx),
</span></span><span style="display:flex;"><span>        x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>, nWorkers),
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">-1</span>,nWorkers),
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">-1</span>,nWorkers),
</span></span><span style="display:flex;"><span>              <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,nWorkers),<span style="color:#000;font-weight:bold">-</span>nWorkers))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A           <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rbind</span>(model<span style="color:#000;font-weight:bold">$</span>A, B)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs         <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>rhs,<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">0</span>,nWorkers<span style="color:#099">+1</span>))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>sense,<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#d14">&#39;=&#39;</span>,nWorkers<span style="color:#099">+1</span>))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>constrnames <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>constrnames,
</span></span><span style="display:flex;"><span>                       <span style="color:#900;font-weight:bold">sprintf</span>(<span style="color:#d14">&#39;DiffShifts%s&#39;</span>,Workers[1<span style="color:#000;font-weight:bold">:</span>nWorkers]),
</span></span><span style="display:flex;"><span>                       <span style="color:#d14">&#39;AvgShift&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Objective: minimize the sum of the square of the difference from the</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># average number of shifts worked</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>obj <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>Q   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(nVars,nVars,
</span></span><span style="display:flex;"><span>                i <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">diffShiftIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers)),
</span></span><span style="display:flex;"><span>                j <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">diffShiftIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers)),
</span></span><span style="display:flex;"><span>                x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,nWorkers))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Save modified model</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">gurobi_write</span>(model,<span style="color:#d14">&#39;workforce4b.lp&#39;</span>, env)
</span></span></code></pre></div><pre tabindex="0"><code>## NULL
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Optimize</span>
</span></span><span style="display:flex;"><span>result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">solveandprint</span>(model, env)
</span></span></code></pre></div><pre tabindex="0"><code>## Gurobi Optimizer version 9.1.2 build v9.1.2rc0 (win64)
## Thread count: 10 physical cores, 20 logical processors, using up to 20 threads
## Optimize a model with 30 rows, 128 columns and 261 nonzeros
## Model fingerprint: 0x377bf6f1
## Model has 7 quadratic objective terms
## Variable types: 30 continuous, 98 integer (98 binary)
## Coefficient statistics:
##   Matrix range     [1e+00, 7e+00]
##   Objective range  [0e+00, 0e+00]
##   QObjective range [2e+00, 2e+00]
##   Bounds range     [1e+00, 6e+00]
##   RHS range        [2e+00, 7e+00]
## Found heuristic solution: objective 37.7142857
## Presolve removed 6 rows and 63 columns
## Presolve time: 0.00s
## Presolved: 24 rows, 65 columns, 136 nonzeros
## Presolved model has 7 quadratic objective terms
## Variable types: 7 continuous, 58 integer (50 binary)
## 
## Root relaxation: objective 2.142857e-01, 221 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
## H    0     0                      25.7142857    0.00000   100%     -    0s
##      0     0    0.21429    0   12   25.71429    0.21429  99.2%     -    0s
## H    0     0                       7.7142857    0.21429  97.2%     -    0s
## H    0     0                       1.7142857    0.21429  87.5%     -    0s
##      0     0    0.21429    0   12    1.71429    0.21429  87.5%     -    0s
##      0     2    0.21429    0   12    1.71429    0.21429  87.5%     -    0s
## 
## Explored 19 nodes (275 simplex iterations) in 0.02 seconds
## Thread count was 20 (of 20 available processors)
## 
## Solution count 4: 1.71429 7.71429 25.7143 37.7143 
## 
## Optimal solution found (tolerance 1.00e-04)
## Best objective 1.714285714285e+00, best bound 1.714285714285e+00, gap 0.0000%
## The optimal objective is 1.714286 
## Schedule:
## 	 Mon1 :Bob  Ed  Fred  
## 	 Tue2 :Bob  Fred  
## 	 Wed3 :Amy  Cathy  Dan  Ed  
## 	 Thu4 :Cathy  Ed  
## 	 Fri5 :Amy  Bob  Cathy  Dan  Gu  
## 	 Sat6 :Bob  Dan  Fred  Gu  
## 	 Sun7 :Amy  Cathy  Ed  Gu  
## 	 Mon8 :Bob  Cathy  
## 	 Tue9 :Dan  Fred  
## 	 Wed10 :Amy  Dan  Gu  
## 	 Thu11 :Bob  Dan  Ed  Gu  
## 	 Fri12 :Amy  Cathy  Dan  Fred  Gu  
## 	 Sat13 :Amy  Bob  Cathy  Dan  Ed  Fred  Gu  
## 	 Sun14 :Amy  Cathy  Ed  Fred  Gu  
## Workload:
## 	 Amy : 7 
## 	 Bob : 7 
## 	 Cathy : 8 
## 	 Dan : 8 
## 	 Ed : 7 
## 	 Fred : 7 
## 	 Gu : 8
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">if </span>(result<span style="color:#000;font-weight:bold">$</span>status <span style="color:#000;font-weight:bold">!=</span> <span style="color:#d14">&#39;OPTIMAL&#39;</span>) <span style="color:#900;font-weight:bold">stop</span>(<span style="color:#d14">&#39;Stop now\n&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Clear space</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">rm</span>(model, env, availability, Shifts, Workers, shiftRequirements, result)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Assign workers to shifts; each worker may or may not be available on a</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># particular day. We use multi-objective optimization to solve the model.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># The highest-priority objective minimizes the sum of the slacks</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># (i.e., the total number of uncovered shifts). The secondary objective</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># minimizes the difference between the maximum and minimum number of</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># shifts worked among all workers.  The second optimization is allowed</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># to degrade the first objective by up to the smaller value of 10% and 2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># define data</span>
</span></span><span style="display:flex;"><span>nShifts       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">14</span>
</span></span><span style="display:flex;"><span>nWorkers      <span style="color:#000;font-weight:bold">&lt;-</span>  <span style="color:#099">8</span>
</span></span><span style="display:flex;"><span>nVars         <span style="color:#000;font-weight:bold">&lt;-</span> (nShifts <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">*</span> (nWorkers <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>varIdx        <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(w,s) {s<span style="color:#000;font-weight:bold">+</span>(w<span style="color:#099">-1</span>)<span style="color:#000;font-weight:bold">*</span>nShifts}
</span></span><span style="display:flex;"><span>shiftSlackIdx <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(s) {s<span style="color:#000;font-weight:bold">+</span>nShifts<span style="color:#000;font-weight:bold">*</span>nWorkers}
</span></span><span style="display:flex;"><span>totShiftIdx   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(w) {w <span style="color:#000;font-weight:bold">+</span> nShifts <span style="color:#000;font-weight:bold">*</span> (nWorkers<span style="color:#099">+1</span>)}
</span></span><span style="display:flex;"><span>minShiftIdx   <span style="color:#000;font-weight:bold">&lt;-</span> ((nShifts<span style="color:#099">+1</span>)<span style="color:#000;font-weight:bold">*</span>(nWorkers<span style="color:#099">+1</span>))
</span></span><span style="display:flex;"><span>maxShiftIdx   <span style="color:#000;font-weight:bold">&lt;-</span> (minShiftIdx<span style="color:#099">+1</span>)
</span></span><span style="display:flex;"><span>totalSlackIdx <span style="color:#000;font-weight:bold">&lt;-</span> nVars
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Shifts  <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#39;Mon1&#39;</span>, <span style="color:#d14">&#39;Tue2&#39;</span>, <span style="color:#d14">&#39;Wed3&#39;</span>, <span style="color:#d14">&#39;Thu4&#39;</span>, <span style="color:#d14">&#39;Fri5&#39;</span>, <span style="color:#d14">&#39;Sat6&#39;</span>, <span style="color:#d14">&#39;Sun7&#39;</span>,
</span></span><span style="display:flex;"><span>             <span style="color:#d14">&#39;Mon8&#39;</span>, <span style="color:#d14">&#39;Tue9&#39;</span>, <span style="color:#d14">&#39;Wed10&#39;</span>, <span style="color:#d14">&#39;Thu11&#39;</span>, <span style="color:#d14">&#39;Fri12&#39;</span>, <span style="color:#d14">&#39;Sat13&#39;</span>, <span style="color:#d14">&#39;Sun14&#39;</span>)
</span></span><span style="display:flex;"><span>Workers <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>( <span style="color:#d14">&#39;Amy&#39;</span>, <span style="color:#d14">&#39;Bob&#39;</span>, <span style="color:#d14">&#39;Cathy&#39;</span>, <span style="color:#d14">&#39;Dan&#39;</span>, <span style="color:#d14">&#39;Ed&#39;</span>, <span style="color:#d14">&#39;Fred&#39;</span>, <span style="color:#d14">&#39;Gu&#39;</span>, <span style="color:#d14">&#39;Tobi&#39;</span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>shiftRequirements <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">3</span>, <span style="color:#099">2</span>, <span style="color:#099">4</span>, <span style="color:#099">4</span>, <span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">5</span>, <span style="color:#099">2</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>, <span style="color:#099">6</span>, <span style="color:#099">7</span>, <span style="color:#099">5</span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>availability <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>( <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ),
</span></span><span style="display:flex;"><span>                      <span style="color:#900;font-weight:bold">c</span>( <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span> ) )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Function to display results</span>
</span></span><span style="display:flex;"><span>solveandprint <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">function</span>(model, env) {
</span></span><span style="display:flex;"><span>  result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">gurobi</span>(model, env <span style="color:#000;font-weight:bold">=</span> env)
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">if</span>(result<span style="color:#000;font-weight:bold">$</span>status <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;OPTIMAL&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;The optimal objective is&#39;</span>,result<span style="color:#000;font-weight:bold">$</span>objval,<span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Schedule:\n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">for </span>(s in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts) {
</span></span><span style="display:flex;"><span>      <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;\t&#39;</span>,Shifts[s],<span style="color:#d14">&#39;:&#39;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#900;font-weight:bold">for </span>(w in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers) {
</span></span><span style="display:flex;"><span>        <span style="color:#900;font-weight:bold">if </span>(result<span style="color:#000;font-weight:bold">$</span>x<span style="color:#900;font-weight:bold">[varIdx</span>(w,s)] <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0.9</span>) <span style="color:#900;font-weight:bold">cat</span>(Workers[w],<span style="color:#d14">&#39; &#39;</span>)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Workload:\n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">for </span>(w in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers) {
</span></span><span style="display:flex;"><span>      <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;\t&#39;</span>,Workers[w],<span style="color:#d14">&#39;:&#39;</span>,result<span style="color:#000;font-weight:bold">$</span>x<span style="color:#900;font-weight:bold">[totShiftIdx</span>(w)],<span style="color:#d14">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  } else {
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">cat</span>(<span style="color:#d14">&#39;Optimization finished with status&#39;</span>,result<span style="color:#000;font-weight:bold">$</span>status)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  result
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set-up environment</span>
</span></span><span style="display:flex;"><span>env <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>env<span style="color:#000;font-weight:bold">$</span>logfile <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;workforce5.log&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Build model</span>
</span></span><span style="display:flex;"><span>model            <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>modelname  <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;workforce5&#39;</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>modelsense <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;min&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Initialize assignment decision variables:</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#    x[w][s] == 1 if worker w is assigned to shift s.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#    This is no longer a pure assignment model, so we must</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#    use binary variables.</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>vtype    <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#d14">&#39;C&#39;</span>, nVars)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>lb       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">0</span>, nVars)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>ub       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>, nVars)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>varnames <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#d14">&#39;&#39;</span>,nVars)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">for </span>(w in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers) {
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">for </span>(s in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts) {
</span></span><span style="display:flex;"><span>    model<span style="color:#000;font-weight:bold">$</span>vtype<span style="color:#900;font-weight:bold">[varIdx</span>(w,s)]    <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;B&#39;</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#000;font-weight:bold">$</span>varnames<span style="color:#900;font-weight:bold">[varIdx</span>(w,s)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(Workers[w],<span style="color:#d14">&#39;.&#39;</span>,Shifts[s])
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">if </span>(availability[[w]][s] <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span>) model<span style="color:#000;font-weight:bold">$</span>ub<span style="color:#900;font-weight:bold">[varIdx</span>(w,s)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Initialize shift slack variables</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">for </span>(s in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts) {
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>varnames<span style="color:#900;font-weight:bold">[shiftSlackIdx</span>(s)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#39;ShiftSlack&#39;</span>,Shifts[s])
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>ub<span style="color:#900;font-weight:bold">[shiftSlackIdx</span>(s)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Initialize worker slack and diff variables</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">for </span>(w in <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers) {
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>varnames<span style="color:#900;font-weight:bold">[totShiftIdx</span>(w)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">paste0</span>(<span style="color:#d14">&#39;TotalShifts&#39;</span>,Workers[w])
</span></span><span style="display:flex;"><span>  model<span style="color:#000;font-weight:bold">$</span>ub<span style="color:#900;font-weight:bold">[totShiftIdx</span>(w)]       <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Initialize min/max shift variables</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>ub[minShiftIdx]       <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>varnames[minShiftIdx] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;MinShift&#39;</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>ub[maxShiftIdx]       <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>varnames[maxShiftIdx] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;MaxShift&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Initialize total slack variable</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>ub[totalSlackIdx]      <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Inf</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>varnames[totalSlackIdx] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;TotalSlack&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set-up shift-requirements constraints</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A           <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(nShifts,nVars,
</span></span><span style="display:flex;"><span>                      i <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">mapply</span>(rep,<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts,nWorkers)),
</span></span><span style="display:flex;"><span>                            <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts)),
</span></span><span style="display:flex;"><span>                      j <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">mapply</span>(varIdx,<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers,
</span></span><span style="display:flex;"><span>                                 <span style="color:#900;font-weight:bold">mapply</span>(rep,<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts,nWorkers)),
</span></span><span style="display:flex;"><span>                            <span style="color:#900;font-weight:bold">shiftSlackIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts)),
</span></span><span style="display:flex;"><span>                      x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,nShifts <span style="color:#000;font-weight:bold">*</span> (nWorkers<span style="color:#099">+1</span>)))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#d14">&#39;=&#39;</span>,nShifts)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs         <span style="color:#000;font-weight:bold">&lt;-</span> shiftRequirements
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>constrnames <span style="color:#000;font-weight:bold">&lt;-</span> Shifts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set TotalSlack equal to the sum of each shift slack</span>
</span></span><span style="display:flex;"><span>B <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(<span style="color:#099">1</span>, nVars,
</span></span><span style="display:flex;"><span>        i <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,nShifts<span style="color:#099">+1</span>),
</span></span><span style="display:flex;"><span>        j <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">shiftSlackIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts),totalSlackIdx),
</span></span><span style="display:flex;"><span>        x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,nShifts),<span style="color:#099">-1</span>))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A           <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rbind</span>(model<span style="color:#000;font-weight:bold">$</span>A, B)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs         <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>rhs,<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>sense,<span style="color:#d14">&#39;=&#39;</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>constrnames <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>constrnames, <span style="color:#d14">&#39;TotalSlack&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set total number of shifts for each worker</span>
</span></span><span style="display:flex;"><span>B <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spMatrix</span>(nWorkers, nVars,
</span></span><span style="display:flex;"><span>          i <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">mapply</span>(rep,<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers,nShifts),
</span></span><span style="display:flex;"><span>                <span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers),
</span></span><span style="display:flex;"><span>          j <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">mapply</span>(varIdx,<span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">mapply</span>(rep,<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers,nShifts)),<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nShifts),
</span></span><span style="display:flex;"><span>                <span style="color:#900;font-weight:bold">totShiftIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers)),
</span></span><span style="display:flex;"><span>          x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">1</span>,nShifts<span style="color:#000;font-weight:bold">*</span>nWorkers),<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">-1</span>,nWorkers)))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>A           <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">rbind</span>(model<span style="color:#000;font-weight:bold">$</span>A, B)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>rhs         <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>rhs,<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">0</span>,nWorkers))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>sense       <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>sense,<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#d14">&#39;=&#39;</span>,nWorkers))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>constrnames <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(model<span style="color:#000;font-weight:bold">$</span>constrnames, <span style="color:#900;font-weight:bold">sprintf</span>(<span style="color:#d14">&#39;TotalShifts%s&#39;</span>,Workers[1<span style="color:#000;font-weight:bold">:</span>nWorkers]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set minShift / maxShift general constraints</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>genconmin <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>(<span style="color:#900;font-weight:bold">list</span>(resvar <span style="color:#000;font-weight:bold">=</span> minShiftIdx,
</span></span><span style="display:flex;"><span>                             vars   <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">totShiftIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers)),
</span></span><span style="display:flex;"><span>                             name   <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;MinShift&#39;</span>))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>genconmax <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>(<span style="color:#900;font-weight:bold">list</span>(resvar <span style="color:#000;font-weight:bold">=</span> maxShiftIdx,
</span></span><span style="display:flex;"><span>                             vars   <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">totShiftIdx</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span>nWorkers)),
</span></span><span style="display:flex;"><span>                             name   <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;MaxShift&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Set multiobjective</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>(<span style="color:#099">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">2</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[1]]          <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[1]]<span style="color:#000;font-weight:bold">$</span>objn     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">0</span>,nVars))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[1]]<span style="color:#000;font-weight:bold">$</span>objn[totalSlackIdx] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[1]]<span style="color:#000;font-weight:bold">$</span>priority <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[1]]<span style="color:#000;font-weight:bold">$</span>weight   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[1]]<span style="color:#000;font-weight:bold">$</span>abstol   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[1]]<span style="color:#000;font-weight:bold">$</span>reltol   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0.1</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[1]]<span style="color:#000;font-weight:bold">$</span>name     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;TotalSlack&#39;</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[1]]<span style="color:#000;font-weight:bold">$</span>con      <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[2]]          <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[2]]<span style="color:#000;font-weight:bold">$</span>objn     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#900;font-weight:bold">rep</span>(<span style="color:#099">0</span>,nVars))
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[2]]<span style="color:#000;font-weight:bold">$</span>objn[minShiftIdx] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-1</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[2]]<span style="color:#000;font-weight:bold">$</span>objn[maxShiftIdx] <span style="color:#000;font-weight:bold">=</span>  <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[2]]<span style="color:#000;font-weight:bold">$</span>priority <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[2]]<span style="color:#000;font-weight:bold">$</span>weight   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[2]]<span style="color:#000;font-weight:bold">$</span>abstol   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[2]]<span style="color:#000;font-weight:bold">$</span>reltol   <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[2]]<span style="color:#000;font-weight:bold">$</span>name     <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#39;Fairness&#39;</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">$</span>multiobj[[2]]<span style="color:#000;font-weight:bold">$</span>con      <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Save initial model</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">gurobi_write</span>(model,<span style="color:#d14">&#39;workforce5.lp&#39;</span>, env)
</span></span></code></pre></div><pre tabindex="0"><code>## NULL
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Optimize</span>
</span></span><span style="display:flex;"><span>result <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">solveandprint</span>(model, env)
</span></span></code></pre></div><pre tabindex="0"><code>## Gurobi Optimizer version 9.1.2 build v9.1.2rc0 (win64)
## Thread count: 10 physical cores, 20 logical processors, using up to 20 threads
## Optimize a model with 23 rows, 137 columns and 261 nonzeros
## Model fingerprint: 0x68a3b7b1
## Model has 2 general constraints
## Variable types: 25 continuous, 112 integer (112 binary)
## Coefficient statistics:
##   Matrix range     [1e+00, 1e+00]
##   Objective range  [1e+00, 1e+00]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [2e+00, 7e+00]
## 
## ---------------------------------------------------------------------------
## Multi-objectives: starting optimization with 2 objectives ... 
## ---------------------------------------------------------------------------
## 
## Multi-objectives: applying initial presolve ...
## ---------------------------------------------------------------------------
## 
## Presolve added 13 rows and 0 columns
## Presolve removed 0 rows and 3 columns
## Presolve time: 0.00s
## Presolved: 36 rows and 134 columns
## ---------------------------------------------------------------------------
## 
## Multi-objectives: optimize objective 1 (TotalSlack) ...
## ---------------------------------------------------------------------------
## 
## Presolve added 8 rows and 0 columns
## Presolve removed 0 rows and 20 columns
## Presolve time: 0.00s
## Presolved: 44 rows, 114 columns, 224 nonzeros
## Presolved model has 8 SOS constraint(s)
## Variable types: 18 continuous, 96 integer (81 binary)
## Found heuristic solution: objective 7.0000000
## Found heuristic solution: objective 6.0000000
## 
## Root relaxation: objective 3.000000e+00, 30 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0    3.00000    0    4    6.00000    3.00000  50.0%     -    0s
## H    0     0                       3.0000000    3.00000  0.00%     -    0s
##      0     0    3.00000    0    4    3.00000    3.00000  0.00%     -    0s
## 
## Explored 1 nodes (30 simplex iterations) in 0.01 seconds
## Thread count was 20 (of 20 available processors)
## 
## Solution count 3: 3 6 7 
## 
## Optimal solution found (tolerance 1.00e-04)
## Best objective 3.000000000000e+00, best bound 3.000000000000e+00, gap 0.0000%
## ---------------------------------------------------------------------------
## 
## Multi-objectives: optimize objective 2 (Fairness) ...
## ---------------------------------------------------------------------------
## 
## 
## Loaded user MIP start with objective 4
## 
## Presolve added 8 rows and 0 columns
## Presolve removed 0 rows and 10 columns
## Presolve time: 0.00s
## Presolved: 45 rows, 124 columns, 273 nonzeros
## Presolved model has 8 SOS constraint(s)
## Variable types: 18 continuous, 106 integer (81 binary)
## 
## Root relaxation: objective 0.000000e+00, 74 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0    0.00000    0   16    4.00000    0.00000   100%     -    0s
## H    0     0                       2.0000000    0.00000   100%     -    0s
## H    0     0                       1.0000000    0.00000   100%     -    0s
##      0     0    0.14286    0   20    1.00000    0.14286  85.7%     -    0s
##      0     0    0.14286    0   19    1.00000    0.14286  85.7%     -    0s
##      0     0    0.14286    0   21    1.00000    0.14286  85.7%     -    0s
##      0     0    0.14286    0   20    1.00000    0.14286  85.7%     -    0s
##      0     0    0.14286    0   19    1.00000    0.14286  85.7%     -    0s
##      0     2    0.14286    0   19    1.00000    0.14286  85.7%     -    0s
## 
## Explored 3265 nodes (9169 simplex iterations) in 0.12 seconds
## Thread count was 20 (of 20 available processors)
## 
## Solution count 4: 1 1 2 4 
## 
## Optimal solution found (tolerance 1.00e-04)
## Best objective 1.000000000000e+00, best bound 1.000000000000e+00, gap 0.0000%
## 
## ---------------------------------------------------------------------------
## Multi-objectives: solved in 0.12 seconds, solution count 6
## 
## The optimal objective is 4 1 
## Schedule:
## 	 Mon1 :Bob  Fred  Tobi  
## 	 Tue2 :Amy  Bob  
## 	 Wed3 :Cathy  Dan  Fred  Gu  
## 	 Thu4 :Cathy  Ed  Gu  
## 	 Fri5 :Amy  Bob  Cathy  Dan  Ed  
## 	 Sat6 :Bob  Dan  Fred  Gu  Tobi  
## 	 Sun7 :Amy  Cathy  Ed  Gu  Tobi  
## 	 Mon8 :Bob  Ed  
## 	 Tue9 :Dan  Fred  
## 	 Wed10 :Amy  Cathy  Dan  
## 	 Thu11 :Amy  Bob  Ed  Gu  
## 	 Fri12 :Cathy  Dan  Fred  Tobi  
## 	 Sat13 :Amy  Bob  Cathy  Dan  Ed  Fred  Tobi  
## 	 Sun14 :Amy  Ed  Fred  Gu  Tobi  
## Workload:
## 	 Amy : 7 
## 	 Bob : 7 
## 	 Cathy : 7 
## 	 Dan : 7 
## 	 Ed : 7 
## 	 Fred : 7 
## 	 Gu : 6 
## 	 Tobi : 6
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">if </span>(result<span style="color:#000;font-weight:bold">$</span>status <span style="color:#000;font-weight:bold">!=</span> <span style="color:#d14">&#39;OPTIMAL&#39;</span>) <span style="color:#900;font-weight:bold">stop</span>(<span style="color:#d14">&#39;Stop now\n&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Clear space</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">rm</span>(model, env, availability, Shifts, Workers, shiftRequirements, result)
</span></span></code></pre></div><p>Add a new chunk by clicking the <em>Insert Chunk</em> button on the toolbar or by pressing <em>Ctrl+Alt+I</em>.</p>
<p>When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the <em>Preview</em> button or press <em>Ctrl+Shift+K</em> to preview the HTML file).</p>
<p>The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike <em>Knit</em>, <em>Preview</em> does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.</p>

        
        <details closed class="f6 fw7 input-reset">
  <dl class="f6 lh-copy">
    <dt class="fw7">Posted on:</dt>
    <dd class="fw5 ml0">January 6, 2020</dd>
  </dl>
  <dl class="f6 lh-copy">
    <dt class="fw7">Length:</dt>
    <dd class="fw5 ml0">25 minute read, 5248 words</dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Categories:</dt>
    <dd class="fw5 ml0"> <a href="/categories/orie-techniques">ORIE Techniques</a> </dd>
  </dl>
  
  
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Tags:</dt>
    <dd class="fw5 ml0"> <a href="/tags/r-markdown">R Markdown</a>  <a href="/tags/qp">QP</a>  <a href="/tags/gurboi">Gurboi</a>  <a href="/tags/algorithms">Algorithms</a> </dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">See Also:</dt>
    
    <dd class="fw5 ml0"><a href="/blog/orie/decomp-algorithms/decompo_algs/">Decompositions Algorithms Broken Down and Explained</a></dd>
    
    <dd class="fw5 ml0"><a href="/blog/orie/bender-decomp/benders/">Benders Decomposition Algorithm Explained</a></dd>
    
    <dd class="fw5 ml0"><a href="/blog/orie/qp-modeling/qp_algorithms/">Quadratic Programming Examples and Algorithms</a></dd>
    
  </dl>
</details>

      </section>
      <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
    <a class="prev dtc pr2 tl v-top fw6"
    href="/blog/orie/qp-modeling/qp_algorithms/">&larr; Quadratic Programming Examples and Algorithms</a>
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="/blog/orie/gurobi-examples/gurobi_examples/">Gurobi Basic LP/MIP Examples &rarr;</a>
  
</div>

      </footer>
    </article>
    
      
<div class="post-comments pa0 pa4-l mt4">
  
  <script src="https://utteranc.es/client.js"
          repo="apreshill/apero"
          issue-term="pathname"
          theme="boxy-light"
          label="comments :crystal_ball:"
          crossorigin="anonymous"
          async
          type="text/javascript">
  </script>
  
</div>

    
  </section>
</main>
<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2023 Erick Jones, Texas
      <span class="middot-divider"></span>
      Made with <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source">Hugo Apéro</a></span>.
      <br />
      
Based on <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source">Blogophonic</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL">Formspree</a>.
    </p>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
    </div>
  </nav>
  
    <script>

    var i, text, code, codes = document.getElementsByTagName('code');
    for (let i = 0; i < codes.length;) {
      code = codes[i];
      if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
          code.textContent = text;
        }
        if (/^\\\((.|\s)+\\\)$/.test(text) ||
            /^\\\[(.|\s)+\\\]$/.test(text) ||
            /^\$(.|\s)+\$$/.test(text) ||
            /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
          code.outerHTML = code.innerHTML;  
          continue;
        }
      }
      i++;
    }
</script>

  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>



    
  
  
</footer>

      </div>
    </body>
</html>
